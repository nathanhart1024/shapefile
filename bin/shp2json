#!/usr/bin/env node

var shapefile = require("../");

var out = process.stdout;

shapefile.open(process.argv[2])
  .then((file) => file.header()
    .then((header) => (out.write(`{"type":"FeatureCollection","bbox":${JSON.stringify(header.bbox)},"features":[`), file.record()))
    .then((record) => record && (out.write(`\n${JSON.stringify(record)}`), file.record()
      .then(function next() { return file.record().then((record) => record && (out.write(`,\n${JSON.stringify(record)}`), next())); })
      .then(() => out.write("\n"))))
    .catch((error) => file.close().then(() => { throw error; }))
    .then(() => (out.write("]}\n"), file.close())))
  .catch((error) => console.error(error.stack));
